{"ast":null,"code":"/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { getWindowId, onDidUnregisterWindow } from './dom.js';\nimport { Emitter, Event } from '../common/event.js';\nimport { Disposable, markAsSingleton } from '../common/lifecycle.js';\n/**\n * See https://developer.mozilla.org/en-US/docs/Web/API/Window/devicePixelRatio#monitoring_screen_resolution_or_zoom_level_changes\n */\nclass DevicePixelRatioMonitor extends Disposable {\n  constructor(targetWindow) {\n    super();\n    this._onDidChange = this._register(new Emitter());\n    this.onDidChange = this._onDidChange.event;\n    this._listener = () => this._handleChange(targetWindow, true);\n    this._mediaQueryList = null;\n    this._handleChange(targetWindow, false);\n  }\n  _handleChange(targetWindow, fireEvent) {\n    this._mediaQueryList?.removeEventListener('change', this._listener);\n    this._mediaQueryList = targetWindow.matchMedia(`(resolution: ${targetWindow.devicePixelRatio}dppx)`);\n    this._mediaQueryList.addEventListener('change', this._listener);\n    if (fireEvent) {\n      this._onDidChange.fire();\n    }\n  }\n}\nclass PixelRatioMonitorImpl extends Disposable {\n  get value() {\n    return this._value;\n  }\n  constructor(targetWindow) {\n    super();\n    this._onDidChange = this._register(new Emitter());\n    this.onDidChange = this._onDidChange.event;\n    this._value = this._getPixelRatio(targetWindow);\n    const dprMonitor = this._register(new DevicePixelRatioMonitor(targetWindow));\n    this._register(dprMonitor.onDidChange(() => {\n      this._value = this._getPixelRatio(targetWindow);\n      this._onDidChange.fire(this._value);\n    }));\n  }\n  _getPixelRatio(targetWindow) {\n    const ctx = document.createElement('canvas').getContext('2d');\n    const dpr = targetWindow.devicePixelRatio || 1;\n    const bsr = ctx.webkitBackingStorePixelRatio || ctx.mozBackingStorePixelRatio || ctx.msBackingStorePixelRatio || ctx.oBackingStorePixelRatio || ctx.backingStorePixelRatio || 1;\n    return dpr / bsr;\n  }\n}\nclass PixelRatioMonitorFacade {\n  constructor() {\n    this.mapWindowIdToPixelRatioMonitor = new Map();\n  }\n  _getOrCreatePixelRatioMonitor(targetWindow) {\n    const targetWindowId = getWindowId(targetWindow);\n    let pixelRatioMonitor = this.mapWindowIdToPixelRatioMonitor.get(targetWindowId);\n    if (!pixelRatioMonitor) {\n      pixelRatioMonitor = markAsSingleton(new PixelRatioMonitorImpl(targetWindow));\n      this.mapWindowIdToPixelRatioMonitor.set(targetWindowId, pixelRatioMonitor);\n      markAsSingleton(Event.once(onDidUnregisterWindow)(({\n        vscodeWindowId\n      }) => {\n        if (vscodeWindowId === targetWindowId) {\n          pixelRatioMonitor?.dispose();\n          this.mapWindowIdToPixelRatioMonitor.delete(targetWindowId);\n        }\n      }));\n    }\n    return pixelRatioMonitor;\n  }\n  getInstance(targetWindow) {\n    return this._getOrCreatePixelRatioMonitor(targetWindow);\n  }\n}\n/**\n * Returns the pixel ratio.\n *\n * This is useful for rendering <canvas> elements at native screen resolution or for being used as\n * a cache key when storing font measurements. Fonts might render differently depending on resolution\n * and any measurements need to be discarded for example when a window is moved from a monitor to another.\n */\nexport const PixelRatio = new PixelRatioMonitorFacade();","map":{"version":3,"names":["getWindowId","onDidUnregisterWindow","Emitter","Event","Disposable","markAsSingleton","DevicePixelRatioMonitor","constructor","targetWindow","_onDidChange","_register","onDidChange","event","_listener","_handleChange","_mediaQueryList","fireEvent","removeEventListener","matchMedia","devicePixelRatio","addEventListener","fire","PixelRatioMonitorImpl","value","_value","_getPixelRatio","dprMonitor","ctx","document","createElement","getContext","dpr","bsr","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","PixelRatioMonitorFacade","mapWindowIdToPixelRatioMonitor","Map","_getOrCreatePixelRatioMonitor","targetWindowId","pixelRatioMonitor","get","set","once","vscodeWindowId","dispose","delete","getInstance","PixelRatio"],"sources":["P:/WebStorm/judgex_front/node_modules/monaco-editor/esm/vs/base/browser/pixelRatio.js"],"sourcesContent":["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { getWindowId, onDidUnregisterWindow } from './dom.js';\nimport { Emitter, Event } from '../common/event.js';\nimport { Disposable, markAsSingleton } from '../common/lifecycle.js';\n/**\n * See https://developer.mozilla.org/en-US/docs/Web/API/Window/devicePixelRatio#monitoring_screen_resolution_or_zoom_level_changes\n */\nclass DevicePixelRatioMonitor extends Disposable {\n    constructor(targetWindow) {\n        super();\n        this._onDidChange = this._register(new Emitter());\n        this.onDidChange = this._onDidChange.event;\n        this._listener = () => this._handleChange(targetWindow, true);\n        this._mediaQueryList = null;\n        this._handleChange(targetWindow, false);\n    }\n    _handleChange(targetWindow, fireEvent) {\n        this._mediaQueryList?.removeEventListener('change', this._listener);\n        this._mediaQueryList = targetWindow.matchMedia(`(resolution: ${targetWindow.devicePixelRatio}dppx)`);\n        this._mediaQueryList.addEventListener('change', this._listener);\n        if (fireEvent) {\n            this._onDidChange.fire();\n        }\n    }\n}\nclass PixelRatioMonitorImpl extends Disposable {\n    get value() {\n        return this._value;\n    }\n    constructor(targetWindow) {\n        super();\n        this._onDidChange = this._register(new Emitter());\n        this.onDidChange = this._onDidChange.event;\n        this._value = this._getPixelRatio(targetWindow);\n        const dprMonitor = this._register(new DevicePixelRatioMonitor(targetWindow));\n        this._register(dprMonitor.onDidChange(() => {\n            this._value = this._getPixelRatio(targetWindow);\n            this._onDidChange.fire(this._value);\n        }));\n    }\n    _getPixelRatio(targetWindow) {\n        const ctx = document.createElement('canvas').getContext('2d');\n        const dpr = targetWindow.devicePixelRatio || 1;\n        const bsr = ctx.webkitBackingStorePixelRatio ||\n            ctx.mozBackingStorePixelRatio ||\n            ctx.msBackingStorePixelRatio ||\n            ctx.oBackingStorePixelRatio ||\n            ctx.backingStorePixelRatio || 1;\n        return dpr / bsr;\n    }\n}\nclass PixelRatioMonitorFacade {\n    constructor() {\n        this.mapWindowIdToPixelRatioMonitor = new Map();\n    }\n    _getOrCreatePixelRatioMonitor(targetWindow) {\n        const targetWindowId = getWindowId(targetWindow);\n        let pixelRatioMonitor = this.mapWindowIdToPixelRatioMonitor.get(targetWindowId);\n        if (!pixelRatioMonitor) {\n            pixelRatioMonitor = markAsSingleton(new PixelRatioMonitorImpl(targetWindow));\n            this.mapWindowIdToPixelRatioMonitor.set(targetWindowId, pixelRatioMonitor);\n            markAsSingleton(Event.once(onDidUnregisterWindow)(({ vscodeWindowId }) => {\n                if (vscodeWindowId === targetWindowId) {\n                    pixelRatioMonitor?.dispose();\n                    this.mapWindowIdToPixelRatioMonitor.delete(targetWindowId);\n                }\n            }));\n        }\n        return pixelRatioMonitor;\n    }\n    getInstance(targetWindow) {\n        return this._getOrCreatePixelRatioMonitor(targetWindow);\n    }\n}\n/**\n * Returns the pixel ratio.\n *\n * This is useful for rendering <canvas> elements at native screen resolution or for being used as\n * a cache key when storing font measurements. Fonts might render differently depending on resolution\n * and any measurements need to be discarded for example when a window is moved from a monitor to another.\n */\nexport const PixelRatio = new PixelRatioMonitorFacade();\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}